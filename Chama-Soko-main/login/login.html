<!DOCTYPE html>
<html class="loading dark-layout" lang="en" data-layout="dark-layout" data-textdirection="ltr">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimal-ui">
    <title>Login | ChamaSoko</title>
    <link rel="shortcut icon" type="image/x-icon" href="./assets/app-assets/images/ico/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./assets/app-assets/vendors/css/vendors.min.css">


    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/components.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/themes/dark-layout.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/themes/bordered-layout.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/themes/semi-dark-layout.css">

    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/core/menu/menu-types/horizontal-menu.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/plugins/forms/form-validation.css">
    <link rel="stylesheet" type="text/css" href="./assets/app-assets/css/pages/authentication.css">


    <link rel="stylesheet" type="text/css" href="https://chamasoko.dashtechinc.com/assets/assets/css/style.css">

</head>


<body class="horizontal-layout horizontal-menu blank-page navbar-floating footer-static" data-open="hover"
    data-menu="horizontal-menu" data-col="blank-page">

    <div class="app-content content ">
        <div class="content-overlay"></div>
        <div class="header-navbar-shadow"></div>
        <div class="content-wrapper">
            <div class="content-header row">
            </div>
            <div class="content-body">
                <div class="auth-wrapper auth-basic px-2">
                    <div class="auth-inner my-2">

                        <div class="card mb-0">
                            <div class="card-body">
                                <a href="#" class="brand-logo">
                                    <img src="./assets/app-assets/images/logo/login_logo.png" class=""
                                        alt="Chama Soko" />
                                </a>
                                <h4 class="card-title mb-1">Welcome to ChamaSoko! ðŸ‘‹</h4>
                                <p class="card-text mb-2">Please Login to your account and start the event</p>
                                <div class="auth-login-form mt-2">
                                    <!--method="POST"-->
                                    <!--action="https://chamasoko.dashtechinc.com/login" autocomplete="off"-->
                                    <label for="login" class="form-label">Email Address</label>
                                    <input id="login-email" type="email" class="form-control "
                                        name="email" value="" required autocomplete="email" autofocus
                                        placeholder="john@example.com" aria-describedby="login-email"
                                        tabindex="1" />
                                </div>
                                <div class="mb-1">
                                    <div class="d-flex justify-content-between">
                                        <label class="form-label" for="login-password">Password</label>
                                    </div>
                                    <div class="input-group input-group-merge form-password-toggle">
                                        <input id="password-id" type="password"
                                            class="form-control form-control-merge " tabindex="2"
                                            placeholder="Password" name="password" required
                                            autocomplete="current-password" aria-describedby="login-password" />
                                        <span class="input-group-text cursor-pointer"><i
                                                data-feather="eye-off"></i></span>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100" id="button-id" tabindex="4">Login</button>
                            </form>
                            <p class="text-center mt-2">
                                <a href="./password-reset.html">
                                    <span>Forgot Your Password?</span>
                                </a>
                            </p>
                             </form>
                            <p class="text-center mt-2">
                                <a href="./create-account.html">
                                    <span>Create Account</span>
                                </a>
                        </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    </div>


    <script src="./app-assets/vendors/js/vendors.min.js"></script>


    <script src="./assets/app-assets/vendors/js/ui/jquery.sticky.js"></script>
    <script src="./assets/app-assets/vendors/js/forms/validation/jquery.validate.min.js"></script>


    <script src="./app-assets/js/core/app-menu.js"></script>
    <script src="./assets/app-assets/js/core/app.js"></script>


    <script src="./assets/app-assets/js/scripts/pages/auth-login.js"></script>

    <script>
        $(window).on('load', function () {
            if (feather) {
                feather.replace({
                    width: 14,
                    height: 14
                });
            }
        })
    </script>
    <script>
        const usertimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        console.log(usertimezone); // Asia/Karachi

    </script>
    <script defer
        src="https://static.cloudflareinsights.com/beacon.min.js/vaafb692b2aea4879b33c060e79fe94621666317369993"
        integrity="sha512-0ahDYl866UMhKuYcW078ScMalXqtFJggm7TmlUtp0UlD4eQk0Ixfnm5ykXKvGJNFjLMoortdseTfsRT8oCfgGA=="
        data-cf-beacon='{"rayId":"7955dbc36a5d6303","version":"2022.11.3","r":1,"token":"02e30844f49d4932b6d531702b001a52","si":100}'
        crossorigin="anonymous"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithRedirect, getRedirectResult, signInWithPopup, signOut, onAuthStateChanged }
            from "https://www.gstatic.com/firebasejs/9.8.4/firebase-auth.js";


   

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDuGwDXdPBbZdB3gnWYhniO4LKZis2ShVY",
            authDomain: "chama-soko-1d814.firebaseapp.com",
            projectId: "chama-soko-1d814",
            storageBucket: "chama-soko-1d814.appspot.com",
            messagingSenderId: "586990826552",
            appId: "1:586990826552:web:7e0440772464e6501462cd",
            measurementId: "G-V2G8FBQPB4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const analytics = getAnalytics(app);

        import { getDatabase, ref, set, child, get }
            from "https://www.gstatic.com/firebasejs/9.8.4/firebase-database.js"

        const db = getDatabase();

        // Referneces

        const email = document.getElementById('login-email');
        const pass = document.getElementById('password-id');
        const submit = document.getElementById('button-id');
        const googleSignIn = document.getElementById('googleSignIn');


        //Authentication Process

        function isEmptyOrSpaces(str) {
            return str == null || str.match(/^ *$/) !== null;
        }

        function tempsignInEmail(){
                alert('hello')


        }

        function signInEmail() { 
            const dbRef = ref(db);

            if (isEmptyOrSpaces(email.value) || isEmptyOrSpaces(pass.value)) {
                alert("You left one or more fields blank");
            }
            else {
                signInWithEmailAndPassword(auth, email.value, pass.value)
                    .then((userCredential) => {
                        // Signed in
                        const user = userCredential.user;
                        login(user);
                    })
                    .catch((error) => {
                        alert("error" + error);
                    });
            }
        }

        function signInGoogle() {
            var provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider)
                .then((result) => {
                    // This gives you a Google Access Token. You can use it to access the Google API.
                    const credential = GoogleAuthProvider.credentialFromResult(result);
                    const token = credential.accessToken;
                    // The signed-in user info.
                    const user = result.user;

                    login(user);
                    // ...
                }).catch((error) => {
                    // Handle Errors here.
                    alert("error" + error);
                    // The email of the user's account used.
                    const email = error.customData.email;
                    // The AuthCredential type that was used.
                    const credential = GoogleAuthProvider.credentialFromError(error);
                    // ...
                });
        }

        //Login

        function login(user) {

            const auth = getAuth();
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const uid = user.uid;
                    window.location = "../index.html";
                    // ...
                } else {
                    alert('Log In Not Sucessful. Please Try Again.');
                    window.location = "../login/login.html";

                    // User is signed out
                    // ...
                }
            });



        }

        //Assign the events

        submit.addEventListener('click', signInEmail);
     //   googleSignIn.addEventListener('click', signInGoogle);

    </script>

    <script src="loginJS/toggle.js"></script>


    </div>
</body>

</html>